import{r as t,M as S,w as d,u as b,aG as D,aH as H,aI as K,aJ as N,x as R}from"./index-B8UuYq4w.js";class W extends t.Component{getSnapshotBeforeUpdate(c){const e=this.props.childRef.current;if(e&&c.isPresent&&!this.props.isPresent){const s=e.offsetParent,a=s instanceof HTMLElement&&s.offsetWidth||0,n=this.props.sizeRef.current;n.height=e.offsetHeight||0,n.width=e.offsetWidth||0,n.top=e.offsetTop,n.left=e.offsetLeft,n.right=a-n.width-n.left}return null}componentDidUpdate(){}render(){return this.props.children}}function A({children:r,isPresent:c,anchorX:e}){const s=t.useId(),a=t.useRef(null),n=t.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:h}=t.useContext(S);return t.useInsertionEffect(()=>{const{width:C,height:i,top:f,left:o,right:p}=n.current;if(c||!a.current||!C||!i)return;const m=e==="left"?`left: ${o}`:`right: ${p}`;a.current.dataset.motionPopId=s;const u=document.createElement("style");return h&&(u.nonce=h),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${C}px !important;
            height: ${i}px !important;
            ${m}px !important;
            top: ${f}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[c]),d.jsx(W,{isPresent:c,childRef:a,sizeRef:n,children:t.cloneElement(r,{ref:a})})}const F=({children:r,initial:c,isPresent:e,onExitComplete:s,custom:a,presenceAffectsLayout:n,mode:h,anchorX:C})=>{const i=b(G),f=t.useId();let o=!0,p=t.useMemo(()=>(o=!1,{id:f,initial:c,isPresent:e,custom:a,onExitComplete:m=>{i.set(m,!0);for(const u of i.values())if(!u)return;s&&s()},register:m=>(i.set(m,!1),()=>i.delete(m))}),[e,i,s]);return n&&o&&(p={...p}),t.useMemo(()=>{i.forEach((m,u)=>i.set(u,!1))},[e]),t.useEffect(()=>{!e&&!i.size&&s&&s()},[e]),h==="popLayout"&&(r=d.jsx(A,{isPresent:e,anchorX:C,children:r})),d.jsx(D.Provider,{value:p,children:r})};function G(){return new Map}const E=r=>r.key||"";function I(r){const c=[];return t.Children.forEach(r,e=>{t.isValidElement(e)&&c.push(e)}),c}const O=({children:r,custom:c,initial:e=!0,onExitComplete:s,presenceAffectsLayout:a=!0,mode:n="sync",propagate:h=!1,anchorX:C="left"})=>{const[i,f]=H(h),o=t.useMemo(()=>I(r),[r]),p=h&&!i?[]:o.map(E),m=t.useRef(!0),u=t.useRef(o),y=b(()=>new Map),[$,L]=t.useState(o),[g,v]=t.useState(o);K(()=>{m.current=!1,u.current=o;for(let x=0;x<g.length;x++){const l=E(g[x]);p.includes(l)?y.delete(l):y.get(l)!==!0&&y.set(l,!1)}},[g,p.length,p.join("-")]);const j=[];if(o!==$){let x=[...o];for(let l=0;l<g.length;l++){const w=g[l],M=E(w);p.includes(M)||(x.splice(l,0,w),j.push(w))}return n==="wait"&&j.length&&(x=j),v(I(x)),L(o),null}const{forceRender:k}=t.useContext(N);return d.jsx(d.Fragment,{children:g.map(x=>{const l=E(x),w=h&&!i?!1:o===g||p.includes(l),M=()=>{if(y.has(l))y.set(l,!0);else return;let P=!0;y.forEach(z=>{z||(P=!1)}),P&&(k==null||k(),v(u.current),h&&(f==null||f()),s&&s())};return d.jsx(F,{isPresent:w,initial:!m.current||e?void 0:!1,custom:c,presenceAffectsLayout:a,mode:n,onExitComplete:w?void 0:M,anchorX:C,children:x},l)})})},U="/fallback.jpg",J=({src:r,alt:c="image",className:e,children:s})=>{const[a,n]=t.useState(!1),h=()=>n(!0),C=()=>n(!1);t.useEffect(()=>{const f=o=>{o.key==="Escape"&&C()};return window.addEventListener("keydown",f),()=>window.removeEventListener("keydown",f)},[]);const i=r??U;return d.jsxs(d.Fragment,{children:[d.jsx("div",{onClick:h,className:`cursor-pointer inline-block ${e??""}`,children:s}),d.jsx(O,{children:a&&d.jsx(R.div,{className:"fixed inset-0 z-50 bg-black bg-opacity-80 flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:C,children:d.jsx(R.img,{src:i,alt:c,className:"max-w-full max-h-full object-contain",initial:{scale:.8},animate:{scale:1},exit:{scale:.8},onClick:f=>f.stopPropagation()})})})]})};export{O as A,J as I};
